# 第二章  与C++第一次亲密接触

## main函数

问题：为什么C++只能有一个main函数？

+ 执行程序时，执行程序的进程会首先创建主线程，主线程然后调用约定启动运行时库，由

  启动运行时库调用约定好的 main 函数，自此开始执行用户的代码。main 函数是主线程的执行入口。

+ 一个线程不可能拥有多个执行入口。而且在 C++中，全局符号(变量、函数) 只能有一个定义，main 函数作为一个全局函数，自然也就只能有一个。

## 编译器和链接器

![一个cpp文件如何变成一个exe可执行文件](https://i.loli.net/2021/11/27/2gGol6yJRIaHKit.png)

源文件HelloWorld.cpp经过**编译器(cl.exe)**的编译后，得到一个无法直接执行的目标文件HelloWorld.obj，还需要**链接器(link.exe)**将这个目标文件和 Visual C++所提供的标准库目标文件（比如，libcpmt.lib）整合成最终的可执行文件HelloWorld.exe。

## C++程序的执行过程

主函数之前的准备工作：进入主函数开始执行之前，操作系统会帮我们做很多准备工作。

> 比如，当操作系统接到执行某个程序的指令后，它首先要创建相应的进程并分配私有的进程空间；然后加载器会把可执行文件的数据段和代码段映射到进程的虚拟内存空间中；操作系统接着会初始化程序中定义的全局变量等。
>
> 做好这些准备工作，程序就可以进入主函数开始执行了。



当启动一个程序后，操作系统会创建新的进程来执行这个程序。所谓进程，就是应用程序的一个实例。

操作系统创建进程的时候，会为其分配一定的内存空间（默认堆），作为其私有的虚拟地址空间。

通常，一个应用程序的执行对应于一个进程，进程负责管理这个程序运行时的一切事物，例如资源的分配与调度等等。但是，作为程序执行的调度者，它并不负责程序的执行，具体的执行工作，则是由它所创建的线程来完成的。

每个进程都有一个主线程，如果是多线程应用程序，还可以有多个辅助线程。线程并不拥有资源（它使用的是它所属进程的资源），但是它拥有自己的执行入口、执行的顺序系列和一个执行终点。

## 标准的输入和输出对象

C++标准库中已经预先定义了 4 个最基本的输入/输出流（I/O）对象，只要引入相应的头文件\<iostream\>:

+ 输入的**cin **:用`>>`从cin提取键盘输入数据
+ 负责屏幕输出的**cout **：用`<<`向cout插入程序内的数据
+ 输出程序错误信息的**cerr**
+ 输出日志信息的 **clog**。

## 读写文件

C++标准库提供了 ifstream（input file stream） 和 ofstream（output file stream），用来读取数据和将数据写入文件。它们定义在<fstream>头文件中。

### 读写文件实现

```c++
#include <iostream>
#include <fstream>
using namespace std;
int main()
{ 
 int nYear, nMonth, nDate;
// 创建输入文件流对象 fin，并尝试打开 Data.txt 文件
// 这个文件应该位于 exe 文件相同的目录下，
// 才能直接使用文件名打开，否则应该使用完整的文件路径
 ifstream fin("Date.txt");
 // 判断 Date.txt 文件是否成功打开 
// 如果成功打开文件，则从文件中读取内容
 if( fin.is_open() ) 
 {
 // 用提取符“>>”从文件输入流对象 fin 中读取文件中的数据，并保存到相应的变量
 // 文件中的内容应该是以空格间隔的三个整数，例如：1983 7 3
fin>>nYear>>nMonth>>nDate;
 // 将读取的数据显示到屏幕
 cout<<"文件中记录的日期是"
 <<nYear<<"-"<<nMonth<<"-"<<nDate<<endl;
 // 读取完成后，关闭文件
 fin.close();
 }
 else
 {
 // 如果文件打开失败，则提示错误信息
 cout<<"无法打开文件并进行读取"<<endl;
 }
 
 // 提示用户输入新的数据并将其写入文件
 cout<<"请输入新日期（例如，1981 9 22）："<<endl;
 // 获取用户通过键盘输入的数据并保存到相应的变量中
 cin>>nYear>>nMonth>>nDate;
 //创建输出文件流对象 fout，并尝试打开 Data.txt 文件，
// 如果这个文件不存在，则创建一个新文件并打开
 ofstream fout("Date.txt");
 // 如果成功打开 Date.txt 文件，则将用户输入的数据写入文件
 if( fout.is_open() )
 {
 // 利用插入符“<<”将数据插入文件输出流对象 fout 中，
 // 也就是将数据写入与之关联的 Data.txt 文件中
 // 为了便于将来的读取，这里输出的数据以空格作为间隔
 fout<<nYear<<" "<<nMonth<<" "<<nDate;
 // 写入完成后，关闭文件
 fout.close();
 }
 else
 {
     // 如果无法打开文件，则提示用户信息
     cout<<"无法打开文件并进行写入"<<endl;
 }
 return 0;
}
```

